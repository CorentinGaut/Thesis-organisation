# Anthropocene week 2023
**À quoi rêvent les maquettes ?
École de l’anthropocène - 5ème édition
23 au 27 janvier 2023
Maison du projet de Villeurbanne**

This year's theme is the sensitive perceptionof the urban space: feelings of the so-nores, the flow of people, the shared use of the city.
Thanks to the augmented model, we could imagine what the sensitive experience of the experience of the inhabitants of the new Villeurbanne Gratte-Ciel Centre-Ville district.

## Augmented mockup
We developed a new augmented model for the workshop so that the students could take control of this device and support their theme with a new mediation tool.
We decided to rebuild the lego model of the Gratte-Ciel district because the previous year's edition had scaling issues generated by the old legonizer algorithm. 
In order to be consistent with more classical architect's models, we decided to use a scale of **1/500** with a footprint of **382m*765m** in order to encompass the old 1930's district and the new one. 
This is equivalent to **2 lego plates in width and 5 lego plates** in length. 
Once the right-of-way parameters were validated we began the construction process. 
### Mockup construction
To build the lego model we need the geometrical data of the buildings in order to give it as input to the legonizer algorithm so that it generates the CSV files and starts the construction. 
The objective of the workshop is to show how the Gratte-Ciel district will look like in 2030 with the new buildings constructed. We therefore need two types of data for the construction:
* The data of the existing buildings, which we will retrieve in CityGML format from the Open Data Grand Lyon with the year 2018.
* The buildings of the future district in 2030 which is composed of 3 blocks and will face the 1930 part. 

Each of these data have been transformed in [3DTiles](https://www.ogc.org/standards/3DTiles) format (data adapted for web visualization) in order to be visualized in the JavaScript library [UD-Viz](https://github.com/VCityTeam/UD-Viz) and use the lego transformation tool.

#### Building data for 2018
In order to allow visualization in a browser we used the workflow of transformation of cityGML into 3D tiles by the tool [py3dTilers](https://github.com/VCityTeam/py3dtilers)

First we downloaded the Villeurbanne 2018 data from the Open Data grand lyon : [CityGML 2018 Villeurbanne data](https://data.grandlyon.com/jeux-de-donnees/maquettes-3d-texturees-2018-communes-metropole-lyon/donnees).

Then we cloned the github repository [py3dTilers](https://github.com/VCityTeam/py3dtilers); with the help of the documentation we launched this command to perform the transformation:

     citygml-tiler.exe -o Villeurbanne_2018 --split_surfaces --add_color

Once the transformation was done, we put it on a LIRIS server to visualise it later in [UD-Viz](https://github.com/VCityTeam/UD-Viz).

    scp -r ./Villeurbanne_2018 username@connect.liris.cnrs.fr:/dataset/three-d-tiles-lyon-metropolis/2023/

![image](https://user-images.githubusercontent.com/32339907/215456435-9e307e28-cfa4-4ced-a572-6b235f298b26.png)


#### 2030 Buildings
The 3D model of the buildings in the new district was provided by [the Gratte-Ciel project house](https://www.grattecielcentreville.fr/) in sketchup format.
As this format is not supported by py3DTilers, we had to export it as an obj in sketchup in order to process it.
The model being too detailed, it remained too heavy for a web visualization (600 Mo). 
We therefore decided to simplify it by removing the vegetation from the model and simplifying its geometry using [blender](https://www.blender.org/).
We made several changes in blender:
- Firstly we removed from the geometry by hand, vegetation and roads that were going to be useless in the construction of the lego model as it is too precise information and would not be meaningful in lego.
- We also applied a [blender modifier](https://savoirpourtous.eu/dataInfo/Blender/Modifiers.php) to simplify the mesh. The [Decimate Geometry](https://all3dp.com/2/blender-simplify-mesh-simply-explained/) was used to remove polygons to reduce the file size by 500 MB. 
- Another method of simplifying the model was to voxelise it with the modifier [Remesh](https://docs.blender.org/manual/fr/dev/modeling/modifiers/generate/remesh.html) which also reduced the file by 500 MB.

Once these modifications have been made, the obj file is more suitable for the web format and can be transformed into 3DTiles format with py3DTilers as for CityGML. 
However, unlike the CityGML format which is a georeferenced format, the obj does not have a geospatial position that allows it to be positioned in the UD-Viz space and aligned with the rest of the previously generated 2018 buildings. Py3Dtilers allows us to calculate this positioning in a chosen projection system.
We therefore placed the pivot of the 3D model of the buildings at the desired location in Villeurbanne with the projection system [EPSG:3946](https://epsg.io/3946) which is the one used by UD-Viz.  

x = 1845995, y = 5176290, z = 175

Once the position was chosen, we ran the following command in pyd3Dtilers to transform it into 3DTiles and georeference it.

```Bash
obj-tiler -i ./gratteciel.obj -o ./obj_tilesets --offset 1845995 5176290 175
```

Like the cityGML we have uploaded it to the LIRIS server for viewing in [UD-Viz](https://github.com/VCityTeam/UD-Viz).

```Bash
scp -r ./obj_tilesets username@connect.liris.cnrs.fr:/dataset/three-d-tiles-lyon-metropolis/2023/
```

![image](https://user-images.githubusercontent.com/32339907/215490885-de8caab2-241d-4fc2-8f9a-8fcb74cf2836.png)


#### Legonizer processing
The process of transforming 3DTiles data into lego is done using several tools. The [Legonizer](https://github.com/VCityTeam/Legonizer) which is a [npm package](https://www.npmjs.com/) (default package manager for the Node.js JavaScript runtime environment).
It will perform all the data transformation algorithm.
And the [Legonizer UD-Viz widget](https://github.com/VCityTeam/UD-Viz/tree/legonizer) (JavaScript library for 3D visualization of geospatial data) which will interface to the legonizer and allow us to select the right building footprints for the transformation.

We wanted a lego model of 2 plates wide by 5 plates in order to encompass the remarkable buildings of the neighbourhood. So we took our right of way using legonizer to cover the whole area with a scale of 1/500 to make the model recognisable. 

First of all, we had to generate CSV files with the 2018 data with a right-of-way without the part of the new district because the data of this vintage are visualized with the old buildings that will be destroyed by the 2023 project.

![image](https://user-images.githubusercontent.com/32339907/215496891-08cf6138-3e06-4d60-bbe6-4f3879fb1290.png)

Legonizer parameters former quarter :
- **Position of the selected zone** : x = 1846186, y = 5175949,  z = 162,48362913691938
- **Ratio** : 2.9 (To have a scale of 1/500)
- **Size of the lego mockup** : x = 2, y = 4

After generating the first part of 2018 we displayed the new neighborhood and gave new settings to the legonizer:

![image](https://user-images.githubusercontent.com/32339907/215499150-94371758-7e56-4118-ac2d-eacdebb47a73.png)

Legonizer parameters new district:
- **Position of the selected zone** : x = 1846144, y = 5176233,  z = 163,89770812188243
- **Ratio** : 2.9 (To have a scale of 1/500)
- **Size of the lego mockup** : x = 2, y = 2

#### Mockup construction

The visualization tool in UD-Viz allowed us to make a first visualization of what the lego model could give and thus validate to pass to the construction part on the plates.
The two selections allowed us to generate 10 CSV files which are organised as follows.

| y/x | 0 | 1 |
|---|:-----:|:-----:|
| 4 | 4,0 | 4,1 |
| 3 | 3,0 | 3,1 |
| 2 | 2,0 | 2,1 |
| 1 | 1,0 | 1,1 |
| 0 | 0,0 | 0,1 |

[Lien vers les fichiers CSV](https://partage.liris.cnrs.fr/index.php/apps/files/?dir=/VCity/Data/CSV/Gratte-ciel-2018&fileid=200956370)

Example :

![image](https://user-images.githubusercontent.com/32339907/215500466-2a436cf2-cbd9-4520-8337-a04a13d100c1.png)

The construction of the Lego model took about 1 day with 7 people, the model was improved by laying flat legos which made it easier to project and smoother.


### Data Projection 
Once the lego model is built and placed correctly on the table, the projection can be set up. To project data onto this white model we use a video projector placed on top of it to project a web browser with the [SlideShow widget](https://ud-viz.vcityliris.data.alpha.grandlyon.com/examples/AllWidget/example.html) from UD-Viz. 

The SlideShow allows you to add images and videos on a georeferenced map in the 3D scene. It can be oriented as you wish so that it maps best with the geospatial data. 
For the workshop we set up a github repository with only the slideshow so that students can easily take it in hand and have their data layer projected [Demo Anthropocene 2023](https://github.com/VCityTeam/UD_Demo_Anthropocene_2023).

In addition, this slideshow has a mapping tool to ensure that the projection matches the lego model and that the building footprints are displayed correctly on the lego buildings.


## Workshop
* Group 1 -  Immersion temporel Hugo : https://github.com/HugoPasquier/MaquetteWorkShop
* Group 2 - Vivre à contresens : Julien : https://github.com/julien-martins/UD-Unity3DTiles
* Group 3 - le quartier en lumière : Dina : https://github.com/Dina-MR/UD-Unity3DTiles
* Group 4 
* Group 5 - Gratte-fiti : Wesley : https://github.com/wesley-petit/UD-Mire
* Group 6 - Quotidien sonore et appropriation de l'espace - Nils
